
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
        <title>The HaPyLi Programming Language - Variables and the Heap</title>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
	<meta name="keywords" content="">
	<meta name="description" content="">
	<!-- master box -->
	
<meta property="og:site_name" content="The HaPyLi Programming Language" />
<meta property="og:title" content="Variables and the Heap" />

<link rel="stylesheet" type="text/css" href="http://static.websimages.com/static/global/theme/css/pluggables.css"/>
<noscript></noscript><!-- --><script type="text/javascript" src="http://www.freewebs.com/p.js"></script><script type="text/javascript" src="http://static.websimages.com/static/global/js/webs/usersites/webs_common.js"></script>
<script type="text/javascript" src="http://static.websimages.com/static/global/js/webs/websover.min.js"></script><link id="templatebase" rel="stylesheet" type="text/css" media="screen" href="http://static.websimages.com/static/global/css/templatebase.css">
<link id="fw_template_file" rel="stylesheet" type="text/css" href="http://hapyli.webs.com/.design.css?r=246" media="screen">
	<link rel="stylesheet" type="text/css" href="http://images.freewebs.com/Members/Generationz/Standard/PrintCSS/print.css" media="print">
</head>
<body class="hasOneColumn hasSidebar navtype-Top" >

<script>var fw_a_cats = ['00'];var fw_a_sizes = ['300x250'];var fw_a_slots = ['user_bbtemplate_300x250'];</script><!-- PUT THIS TAG IN THE head SECTION -->
<script type="text/javascript" src="http://partner.googleadservices.com/gampad/google_service.js">
</script>
<script type="text/javascript">
  GS_googleAddAdSenseService("ca-pub-4763110844767107");
  GS_googleEnableAllServices();
</script>
<script type="text/javascript">
if(fw_a_cats) {
  for(var i=0;i<fw_a_cats.length;i++) {
    GA_googleAddAttr('cat', fw_a_cats[0]);
  }
}
if(typeof(fw_a_wl) != 'undefined') {
  GA_googleAddAttr('wl', fw_a_wl);
}
</script>
<script type="text/javascript">
if(fw_a_slots) {
  for(var i=0;i<fw_a_slots.length;i++) {
    GA_googleAddSlot("ca-pub-4763110844767107", fw_a_slots[i]);
  }
}
</script>
<script type="text/javascript">
  GA_googleFetchAds();
</script>
<!-- END OF TAG FOR head SECTION -->
<script type="text/javascript" src="http://static.websimages.com/JS/fw.js"></script>
<!--
{NavHeaderFormat}
<li class="fw-navheader">{NavHeader}</li>
{/NavHeaderFormat}



-->

<div id="fw-container">
	<div id="fw-head">
		<h1 id="fw-title"><a id="fw-titlelink" href="http://hapyli.webs.com/">The HaPyLi Programming Language</a></h1>
		<h2 id="fw-smalltitle"></h2>
		<div id="logo-div" class="fw-logo"></div>
	</div>

	<div id="fw-blockContainer">
		<div id="fw-mainnavwrap">
			<div id="fw-nav-menu">
				<ul class="fw-nav-level-0">
					<li><a class="section" href="http://hapyli.webs.com/" >Home</a></li>
<li><a class="section" href="http://hapyli.webs.com/apps/forums/" >Forums</a></li>
<li><a class="section" href="http://hapyli.webs.com/examples.htm" >Examples</a></li>

				</ul>
			</div>
		</div>


		<div id="fw-bigcontain">
			


			<div id="fw-mainColumn">
				<!-- ParagraphStart 578215274 -->
			<div class="fw-paragraph">
				<div class="fw-paragraphtop"></div>
				<h3 class="fw-title"><a name="578215274"></a><!-- ParagraphTitleStart --><b><font size="5">Section 3: Variables and the Heap</font></b> <!-- ParagraphTitleEnd --></h3>
				<div class="fw-text"><!-- ParagraphBodyStart --><p>&#160; </p><!-- ParagraphBodyEnd --></div>
				<div class="fw-paragraphbottom"></div>
			</div>
			<!-- ParagraphEnd 578215274 --><!-- ParagraphStart 578215992 -->
			<div class="fw-paragraph">
				<div class="fw-paragraphtop"></div>
				<h3 class="fw-title"><a name="578215992"></a><!-- ParagraphTitleStart -->Global Variables <!-- ParagraphTitleEnd --></h3>
				<div class="fw-text"><!-- ParagraphBodyStart --><p><font size="2">Function parameters and local variables defined in let-forms are allocated on the Whitespace stack. Whitespace, however, also provides access to random-access heap memory. HaPyLi uses this heap for strings and global variables.<hr>
<pre>
    <a href="http://hapyli.webs.com/globals.hpl">File: globals.hpl</a>
    
        import "stdlib/base.hpl"

        var *A = 123
        var *B = (1 2 3)
        var *C = "ABC"
        var *D = ('A' 'B' 'C' '\0')
        var *E(10)

        def print-A () =
            (do (print-number (ref *A)) (print-char '\n'))
            
        def print-B () = 
            (do (print-number (ref *B 0)) (print-char ' ')
                (print-number (ref *B 1)) (print-char ' ')
                (print-number (ref *B 2)) (print-char '\n'))
                
        def print-C () = (do (print-string *C) (print-char '\n'))

        def print-D () = (do (print-string *D) (print-char '\n'))

        def fill (*array size fromIndex value) =
            (if (== fromIndex size)
                0
                (do (set *array fromIndex value)
                    (fill *array size (+ fromIndex 1) value)))
            
        def print-array (*array size fromIndex) = 
            (if (== fromIndex size)
                (print-char '\n')
                (do (print-number (ref *array fromIndex))
                    (print-char ' ')
                    (print-array *array size (+ fromIndex 1))))
            
        def main () = 
            (do (print-A)
                (print-B)
                (print-C)
                (print-D)
                (fill *E 10 0 5)
                (print-array *E 10 0))        

</pre>        
<hr></font></p><p><font size="2">The example above illustrates every type of global variable you can define in HaPyLi and how to read and write to them. The '*' on each variable name isn't anything special - any identifier can contain this character. It is a naming convention I use to distinguish pointers from other kinds of variables. All global variables are pointers to data in the heap. To read from these variables, you must use the &#34;ref&#34; function defined in the HaPyLi Standard Library. Likewise, to write to these variables you must use the &#34;set&#34; function.<br /><br />&#34;ref&#34; accepts a pointer to an array and an index and returns the data stored at that index within the array. (ref *X 0) is equivalent to (ref *X).<br /><br />Likewise, &#34;set&#34; accepts a pointer to an array, an index, and a value, and writes that value to the array at the index. (set *array 0 value) is equivalent to (set *variable value).<br /><br />You must be extremely careful, however, because HaPyLi doesn't provide any bounds checking when reading from or writing to arrays. Writing beyond the end of an array may actually write to a different variable instead. Reading beyond the end of an array, from an address that's never been written to, could actually crash the Whitespace interpreter.</font></p><font size="2">&#160;</font><!-- ParagraphBodyEnd --></div>
				<div class="fw-paragraphbottom"></div>
			</div>
			<!-- ParagraphEnd 578215992 --><!-- ParagraphStart 578216878 -->
			<div class="fw-paragraph">
				<div class="fw-paragraphtop"></div>
				<h3 class="fw-title"><a name="578216878"></a><!-- ParagraphTitleStart -->Local Variables As Pointers <!-- ParagraphTitleEnd --></h3>
				<div class="fw-text"><!-- ParagraphBodyStart --><p><font size="2">The HaPyLi Standard Library defines the &#34;alloc&#34; function which is similar to the &#34;malloc&#34; function in C. It accepts a single parameter indicating the size of the array to allocate and returns a pointer to that array.</font></p><p><font size="2">While C provides both &#34;malloc&#34; and &#34;free&#34;, there is no equivalent to &#34;free&#34; in HaPyLi. Sorry, I never wrote one. The HaPyLi Standard Library is unfinished. You can write your own, however, if it's so important to you. I'll explain everything you need to know in order to do that in the next section. For now, here are examples of &#34;alloc&#34;.<hr>
<pre>
    <a href="http://hapyli.webs.com/alloc.hpl">File: alloc.hpl</a>
    
        import "stdlib/base.hpl"

        var *global = (1 2 3 4 5)

        def copy (*dest *source count) = 
            (if (== count 0)
                0
                (do (set *dest (ref *source))
                    (copy (+ *dest 1) (+ *source 1) (- count 1))))
                

        def print-array (*array size fromIndex) = 
            (if (== fromIndex size)
                (print-char '\n')
                (do (print-number (ref *array fromIndex))
                    (print-char ' ')
                    (print-array *array size (+ fromIndex 1))))
                    
        def main () = 
            let
                *local = (alloc 5)
            in
                (do 
                    (print-array *global 5 0)
                    (copy *local *global 5)
                    (print-array *local 5 0))
</pre>        
<hr> </font></p><p><font size="2">&#160;Remember that HaPyLi is a typeless language. All variables are ultimately integers. In the example above, *global and *local evaluate to the address in heap memory where their data is stored. You can add to and subtract from these pointers as if they were ordinary integers - which is exactly how the &#34;copy&#34; function works.</font></p><p><font size="2">The example below further illustrates this point: <hr>
<pre>
    <a href="http://hapyli.webs.com/pointers.hpl">File: pointers.hpl</a>
    
        import "stdlib/base.hpl"

        var *A = (1 2 3 4 5)

        def print-array (*array size fromIndex) = 
            (if (== fromIndex size)
                (print-char '\n')
                (do (print-number (ref *array fromIndex))
                    (print-char ' ')
                    (print-array *array size (+ fromIndex 1))))

        def main () = 
            let
                *B = (+ *A 2)
            in 
                (do (print-array *A 5 0)
                    (print-array *B 3 0))
</pre>        
<hr></font></p><p><font size="2">&#160;The local variable *B is just like any other array. It points to the beginning of its data in memory. It doesn't matter that *B points to some of the same data as *A.</font></p><!-- ParagraphBodyEnd --></div>
				<div class="fw-paragraphbottom"></div>
			</div>
			<!-- ParagraphEnd 578216878 -->
			</div>

		</div>

		<div id="fw-sidebar">

<!--
			  
-->



			<div id="fw-sidebarbegin"></div>
			
  			<div id="boxad">
					<script type="text/javascript">
  GA_googleFillSlot("user_bbtemplate_300x250");
</script>
			</div>
			
			<div class="fw-paragraph">
				<div class="fw-paragraphtop"></div>
				<h3 class="fw-title">Tutorial</h3>
				<div class="fw-text"><p><a href="http://hapyli.webs.com/functions.htm">1. Functions</a></p><p><a href="http://hapyli.webs.com/expressions.htm">2. Expressions</a></p><p><a href="http://hapyli.webs.com/variablesandtheheap.htm">3. Variables and the Heap</a></p><p><a href="http://hapyli.webs.com/embeddingwhitespace.htm">4. Embedding Whitespace</a></p><p>&#160;</p></div>
				<div class="fw-paragraphbottom"></div>
			</div>
			
			<div class="fw-paragraph">
				<div class="fw-paragraphtop"></div>
				<h3 class="fw-title"><a href="http://hapyli.webs.com/apps/forums/">Recent Forum Posts</a></h3>
				<div class="fw-text">


	
		<i>No recent posts</i>
	


</div>
				<div class="fw-paragraphbottom"></div>
			</div>
			
			<div id="fw-sidebarend"></div>
		</div>

		<div class="clears"></div>
	</div>
    <div class="clears"></div>
</div>

<div id="fw-footer">
	<p id="fw-foottext" class="fw-footertext">Copyright ©2010</p>
	<p><script type="text/javascript">	
function webURL() {
window.location = 'http://www.webs.com/?referer=wftr-' + location.host + '&cm_mmc=Freewebs-_-Free%20Website-_-Freebar-_-static'
}
</script>

<p style="float: left; font-size: 11px; text-align: left;">
<a onclick="webURL(); return false;" href="http://www.webs.com/" value="Create a Free Website at Webs.com" title="Create a Free Website at Webs.com" class="fwftr-input-big fwftr-button">
<span>Create a Free Website</span>
</a>
</p>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>

<script type="text/javascript">
if(typeof(_gaq) == 'undefined') {
try {
var pageTracker = _gat._getTracker("UA-230305-2");
pageTracker._setDomainName("none");
pageTracker._setAllowHash(false);
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}
}
</script>

<p id="wildfire" style="float:right; margin-right:5px;">
	<script type="text/javascript">
  		addthis_url    = location.href;   
  		addthis_title  = document.title;  
  		addthis_pub    = 'webs';     
	</script>
	<script type="text/javascript" src="http://s7.addthis.com/js/addthis_widget.php?v=12"></script>

	<!--<script src="http://cdn.gigya.com/wildfire/JS/WFButton.js?module=share&partner=54291"></script>-->
</p>
</p>
</div>

<!--[if IE 6]>
<script type="text/javascript" src="http://images.webs.com/static/global/js/webs/usersites/ie6subnav.js"></script>
<![endif]-->
<!-- --><script type="text/javascript" src="http://images.webs.com/static/global/js/webs/usersites/escort.js"></script><script type="text/javascript">if(typeof(urchinTracker)=='function'){_uacct="UA-230305-2";_udn="none";_uff=false;urchinTracker();}</script></body>
</html>


<!-- [SB] PageID 178591123-->
<!-- appserver20 -->
